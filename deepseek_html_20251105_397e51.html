<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Price Time Pro</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --accent-color: #e74c3c;
            --promo-color: #9b59b6;
            --max-value-color: #f39c12;
            --light-color: #f9f9f9;
            --dark-color: #333;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: var(--dark-color);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 25px;
            position: relative;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 0;
            font-size: 2.2rem;
        }

        .current-date {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 10px;
            text-align: center;
        }

        .clock-display {
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            background-color: var(--light-color);
            box-shadow: var(--shadow);
            font-family: 'Courier New', monospace;
            color: var(--primary-color);
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }

        input[type="time"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .currency-input {
            text-align: right;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s;
            width: 100%;
            margin-top: 10px;
        }

        button:hover {
            background-color: #2980b9;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
        }

        .btn-secondary:hover {
            background-color: #27ae60;
        }

        .btn-accent {
            background-color: var(--accent-color);
        }

        .btn-accent:hover {
            background-color: #c0392b;
        }

        .btn-small {
            width: auto;
            padding: 8px 15px;
            font-size: 14px;
        }

        .results {
            background-color: var(--light-color);
            padding: 20px;
            border-radius: 5px;
            margin-top: 30px;
            box-shadow: var(--shadow);
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .result-label {
            font-weight: 600;
        }

        .result-value {
            font-weight: 700;
            color: var(--primary-color);
        }

        .total {
            font-size: 1.2rem;
            color: var(--secondary-color);
        }

        .promo-section {
            background-color: rgba(155, 89, 182, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            border-left: 4px solid var(--promo-color);
        }

        .max-value-section {
            background-color: rgba(243, 156, 18, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            border-left: 4px solid var(--max-value-color);
        }

        .section-title {
            font-weight: 600;
            margin-bottom: 10px;
        }

        .promo-title {
            color: var(--promo-color);
        }

        .max-value-title {
            color: var(--max-value-color);
        }

        .conditional-input {
            display: none;
            margin-top: 10px;
        }

        .explanation {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }

        footer {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 0.9rem;
        }

        .config-panel {
            display: none;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            margin-top: 20px;
        }

        .config-section {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .config-section:last-child {
            border-bottom: none;
        }

        .config-title {
            font-size: 1.2rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .checkbox-group {
            margin-bottom: 10px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            font-weight: normal;
            margin-bottom: 5px;
        }

        .checkbox-group input {
            margin-right: 10px;
        }

        .camera-preview {
            width: 100%;
            max-width: 300px;
            height: 200px;
            background-color: #eee;
            margin: 10px 0;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
            font-weight: normal;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .payment-options {
            display: none;
            margin-top: 20px;
            text-align: center;
        }

        .payment-option {
            display: inline-block;
            margin: 0 10px;
            padding: 10px 20px;
            background-color: #f0f0f0;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .payment-option:hover {
            background-color: #e0e0e0;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .action-buttons button {
            flex: 1;
        }

        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            h1 {
                font-size: 1.8rem;
            }
            input[type="time"],
            input[type="number"],
            select,
            button {
                padding: 10px;
            }
            .clock-display {
                font-size: 2rem;
            }
            .payment-option {
                display: block;
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">PTP</div>
                <h1>Price Time Pro</h1>
            </div>
        </header>
        
        <main>
            <div class="current-date" id="current-date">Carregando...</div>
            
            <div class="clock-display" id="clock-display">--:--:--</div>
            
            <div class="form-group">
                <label for="start-time">Hora de Início:</label>
                <input type="time" id="start-time" required>
            </div>
            
            <div class="results" id="results" style="display: none;">
                <div class="result-item">
                    <span class="result-label">Data:</span>
                    <span class="result-value" id="calculation-date">--/--/----</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Hora de Entrada:</span>
                    <span class="result-value" id="entry-time">--:--</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Tempo de Permanência:</span>
                    <span class="result-value" id="duration">--:--</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Período Promocional:</span>
                    <span class="result-value" id="promo-period">Nenhum</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Desconto Promocional:</span>
                    <span class="result-value" id="promo-discount">R$ 0,00</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Desconto Adicional:</span>
                    <span class="result-value" id="discount-amount">R$ 0,00</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Diárias Aplicadas:</span>
                    <span class="result-value" id="daily-count">0</span>
                </div>
                <div class="result-item total">
                    <span class="result-label">Valor a Pagar:</span>
                    <span class="result-value" id="total-amount">R$ 0,00</span>
                </div>
            </div>
            
            <div class="action-buttons">
                <button id="payment-btn" class="btn-secondary">Pagamento</button>
                <button id="save-share-btn" class="btn-accent">Salvar/Compartilhar</button>
            </div>
            
            <div class="payment-options" id="payment-options">
                <div class="payment-option" data-type="pix">Pix</div>
                <div class="payment-option" data-type="debito">Débito</div>
                <div class="payment-option" data-type="credito">Crédito</div>
            </div>
            
            <button id="new-calculation-btn" class="btn-secondary tooltip">
                Novo Cálculo
                <span class="tooltiptext">Limpa a hora de início para um novo cálculo</span>
            </button>
            
            <button id="config-btn" class="btn-accent tooltip">
                Configurações
                <span class="tooltiptext">Abrir painel de configurações</span>
            </button>
            
            <div class="config-panel" id="config-panel">
                <div class="config-section">
                    <div class="config-title">Tipo de Cobrança</div>
                    <div class="form-group">
                        <label for="billing-type">Selecione o Tipo:</label>
                        <select id="billing-type">
                            <option value="normal">Cobrança Normal</option>
                            <option value="unica">Cobrança Única</option>
                            <option value="diaria">Diária</option>
                        </select>
                    </div>
                    <div id="unique-value-section" class="conditional-input">
                        <div class="form-group">
                            <label for="unique-value">Valor Único (R$):</label>
                            <input type="text" id="unique-value" class="currency-input" placeholder="0000,00">
                        </div>
                    </div>
                </div>
                
                <div class="config-section">
                    <div class="config-title">Modelo de Cobrança</div>
                    <div class="form-group">
                        <label for="billing-model">Selecione o Modelo:</label>
                        <select id="billing-model">
                            <option value="manual">Cobrança com Digitação</option>
                            <option value="qrcode">Cobrança com Leitura de QR Code</option>
                            <option value="text">Cobrança com Leitura de Texto</option>
                        </select>
                    </div>
                    <div id="qrcode-section" class="conditional-input">
                        <div class="camera-preview" id="qrcode-preview">
                            Clique para ativar a câmera para leitura de QR Code
                        </div>
                        <button id="start-qrcode" class="btn-small">Iniciar Leitura</button>
                    </div>
                    <div id="text-section" class="conditional-input">
                        <div class="camera-preview" id="text-preview">
                            Clique para ativar a câmera para leitura de texto
                        </div>
                        <button id="start-text" class="btn-small">Iniciar Leitura</button>
                    </div>
                </div>
                
                <div class="config-section">
                    <div class="config-title">Valor por Hora</div>
                    <div class="form-group">
                        <label for="hourly-rate-config">Valor por Hora (R$):</label>
                        <input type="text" id="hourly-rate-config" class="currency-input" placeholder="0000,00" required>
                    </div>
                </div>
                
                <div class="config-section">
                    <div class="config-title">Período Promocional</div>
                    <div class="form-group">
                        <label for="promo-type">Tipo de Período Promocional:</label>
                        <select id="promo-type">
                            <option value="none">Nenhum período promocional</option>
                            <option value="free-hour-1">1ª Hora Grátis</option>
                            <option value="free-hour-2">2ª Hora Grátis</option>
                            <option value="free-hour-3">3ª Hora Grátis</option>
                            <option value="free-15min">15 Minutos Grátis</option>
                        </select>
                    </div>
                    <div class="explanation" id="promo-explanation">
                        Selecione um tipo de período promocional para ver a explicação.
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="promo-2h" value="2h">
                            Valor único até 2 horas
                        </label>
                        <input type="text" id="promo-2h-value" class="conditional-input currency-input" placeholder="0000,00">
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="promo-3h" value="3h">
                            Valor único até 3 horas
                        </label>
                        <input type="text" id="promo-3h-value" class="conditional-input currency-input" placeholder="0000,00">
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="promo-4h" value="4h">
                            Valor único até 4 horas
                        </label>
                        <input type="text" id="promo-4h-value" class="conditional-input currency-input" placeholder="0000,00">
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="promo-6h" value="6h">
                            Valor único até 6 horas
                        </label>
                        <input type="text" id="promo-6h-value" class="conditional-input currency-input" placeholder="0000,00">
                    </div>
                    <div class="form-group">
                        <label for="discount-config">Desconto Adicional (%):</label>
                        <input type="number" id="discount-config" min="0" max="100" step="0.01" placeholder="Ex: 5.00" value="0">
                    </div>
                </div>
                
                <div class="config-section">
                    <div class="config-title">Valor Máximo</div>
                    <div class="form-group">
                        <label for="max-value-config">Valor máximo (R$):</label>
                        <input type="text" id="max-value-config" class="currency-input" placeholder="0000,00">
                    </div>
                </div>
                
                <div class="config-section">
                    <div class="config-title">Diária</div>
                    <div class="form-group">
                        <label for="daily-rate">Valor da Diária (R$):</label>
                        <input type="text" id="daily-rate" class="currency-input" placeholder="0000,00" value="60,00">
                    </div>
                </div>
                
                <button id="save-config" class="btn-secondary">Salvar Configurações</button>
            </div>
        </main>
        
        <footer>
            <p>Os descontos permanecerão aplicados até serem modificados manualmente.</p>
        </footer>
    </div>

    <script>
        // Configurações padrão
        let config = {
            hourlyRate: 10.00,
            discount: 0,
            maxValue: 0,
            dailyRate: 60.00,
            billingModel: 'manual',
            billingType: 'normal',
            uniqueValue: 0,
            promoType: 'none',
            promos: {
                '2h': { active: false, value: 0 },
                '3h': { active: false, value: 0 },
                '4h': { active: false, value: 0 },
                '6h': { active: false, value: 0 }
            }
        };

        // Explicações para cada tipo de promoção (horas grátis)
        const promoExplanations = {
            'none': 'Nenhum período promocional selecionado. O valor será calculado normalmente.',
            'free-hour-1': 'Período: A partir de 0 hora de permanência até a 1ª hora completa de permanência. Este período não será cobrado.',
            'free-hour-2': 'Período: A partir da 1ª hora completa de permanência até a 2ª hora completa de permanência. Este período não será cobrado.',
            'free-hour-3': 'Período: A partir da 2ª hora completa até a 3ª hora completa de permanência. Este período não será cobrado.',
            'free-15min': 'Período: A partir de 0 hora de permanência até 15 minutos de permanência. Este período não será cobrado.'
        };

        // Atualizar data e relógio em tempo real
        function updateDateTime() {
            const now = new Date();
            const dateString = now.toLocaleDateString('pt-BR');
            const timeString = now.toLocaleTimeString('pt-BR');
            
            document.getElementById('current-date').textContent = dateString;
            document.getElementById('clock-display').textContent = timeString;
        }

        // Atualizar o relógio a cada segundo
        setInterval(updateDateTime, 1000);
        updateDateTime(); // Inicializar imediatamente

        // Formatar entrada de moeda
        function formatCurrencyInput(input) {
            // Remover tudo que não é número
            let value = input.value.replace(/\D/g, '');
            
            // Adicionar zeros à esquerda se necessário
            while (value.length < 3) {
                value = '0' + value;
            }
            
            // Formatar como moeda (0000,00)
            const integerPart = value.slice(0, -2) || '0';
            const decimalPart = value.slice(-2);
            
            input.value = `${integerPart},${decimalPart}`;
        }

        // Converter valor formatado para número
        function parseCurrencyValue(value) {
            if (!value) return 0;
            return parseFloat(value.replace('.', '').replace(',', '.'));
        }

        // Configurar hora atual como padrão para o campo de hora de início
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('start-time').value = `${hours}:${minutes}`;

            // Configurar campos de moeda
            const currencyInputs = document.querySelectorAll('.currency-input');
            currencyInputs.forEach(input => {
                // Formatar valor inicial
                if (input.value) {
                    formatCurrencyInput({value: input.value, target: input});
                }
                
                // Adicionar evento de formatação
                input.addEventListener('input', function(e) {
                    formatCurrencyInput(e.target);
                });
            });

            // Carregar configurações salvas
            loadConfig();

            // Calcular automaticamente
            calculate();
        });

        // Mostrar explicações quando o tipo de promoção for alterado
        document.getElementById('promo-type').addEventListener('change', function() {
            const explanation = document.getElementById('promo-explanation');
            explanation.textContent = promoExplanations[this.value];
        });

        // Inicializar a explicação
        document.getElementById('promo-explanation').textContent = promoExplanations['none'];

        // Mostrar/ocultar seção de valor único conforme o tipo de cobrança
        document.getElementById('billing-type').addEventListener('change', function() {
            const uniqueValueSection = document.getElementById('unique-value-section');
            if (this.value === 'unica') {
                uniqueValueSection.style.display = 'block';
            } else {
                uniqueValueSection.style.display = 'none';
            }
        });

        // Função para carregar configurações salvas
        function loadConfig() {
            const savedConfig = localStorage.getItem('priceTimeProConfig');
            if (savedConfig) {
                try {
                    const parsedConfig = JSON.parse(savedConfig);
                    
                    // Atualizar config apenas se os valores existirem
                    if (parsedConfig.hourlyRate !== undefined) config.hourlyRate = parsedConfig.hourlyRate;
                    if (parsedConfig.discount !== undefined) config.discount = parsedConfig.discount;
                    if (parsedConfig.maxValue !== undefined) config.maxValue = parsedConfig.maxValue;
                    if (parsedConfig.dailyRate !== undefined) config.dailyRate = parsedConfig.dailyRate;
                    if (parsedConfig.billingModel !== undefined) config.billingModel = parsedConfig.billingModel;
                    if (parsedConfig.billingType !== undefined) config.billingType = parsedConfig.billingType;
                    if (parsedConfig.uniqueValue !== undefined) config.uniqueValue = parsedConfig.uniqueValue;
                    if (parsedConfig.promoType !== undefined) config.promoType = parsedConfig.promoType;
                    if (parsedConfig.promos !== undefined) config.promos = parsedConfig.promos;

                    // Aplicar configurações na interface
                    document.getElementById('hourly-rate-config').value = config.hourlyRate.toFixed(2).replace('.', ',');
                    document.getElementById('discount-config').value = config.discount;
                    document.getElementById('max-value-config').value = config.maxValue.toFixed(2).replace('.', ',');
                    document.getElementById('daily-rate').value = config.dailyRate.toFixed(2).replace('.', ',');
                    document.getElementById('billing-model').value = config.billingModel;
                    document.getElementById('billing-type').value = config.billingType;
                    document.getElementById('unique-value').value = config.uniqueValue.toFixed(2).replace('.', ',');
                    document.getElementById('promo-type').value = config.promoType;

                    // Aplicar explicação da promoção
                    document.getElementById('promo-explanation').textContent = promoExplanations[config.promoType];

                    // Mostrar/ocultar seção de valor único
                    const uniqueValueSection = document.getElementById('unique-value-section');
                    if (config.billingType === 'unica') {
                        uniqueValueSection.style.display = 'block';
                    } else {
                        uniqueValueSection.style.display = 'none';
                    }

                    // Aplicar configurações de promoções de valor único
                    for (const promo in config.promos) {
                        const checkbox = document.getElementById(`promo-${promo}`);
                        const valueInput = document.getElementById(`promo-${promo}-value`);
                        if (checkbox && valueInput) {
                            checkbox.checked = config.promos[promo].active;
                            valueInput.value = config.promos[promo].value.toFixed(2).replace('.', ',');

                            // Mostrar/ocultar campo de valor
                            if (checkbox.checked) {
                                valueInput.style.display = 'block';
                            } else {
                                valueInput.style.display = 'none';
                            }
                        }
                    }

                    // Mostrar/ocultar seções de câmera
                    toggleCameraSections(config.billingModel);
                } catch (e) {
                    console.error('Erro ao carregar configurações:', e);
                }
            }
        }

        // Função para salvar configurações
        function saveConfig() {
            // Obter valores dos campos
            config.hourlyRate = parseCurrencyValue(document.getElementById('hourly-rate-config').value) || 0;
            config.discount = parseFloat(document.getElementById('discount-config').value) || 0;
            config.maxValue = parseCurrencyValue(document.getElementById('max-value-config').value) || 0;
            config.dailyRate = parseCurrencyValue(document.getElementById('daily-rate').value) || 0;
            config.billingModel = document.getElementById('billing-model').value;
            config.billingType = document.getElementById('billing-type').value;
            config.uniqueValue = parseCurrencyValue(document.getElementById('unique-value').value) || 0;
            config.promoType = document.getElementById('promo-type').value;

            // Obter configurações de promoções de valor único
            for (const promo in config.promos) {
                const checkbox = document.getElementById(`promo-${promo}`);
                const valueInput = document.getElementById(`promo-${promo}-value`);
                if (checkbox && valueInput) {
                    config.promos[promo].active = checkbox.checked;
                    config.promos[promo].value = parseCurrencyValue(valueInput.value) || 0;
                }
            }

            // Salvar no localStorage
            localStorage.setItem('priceTimeProConfig', JSON.stringify(config));

            // Mostrar/ocultar seções de câmera
            toggleCameraSections(config.billingModel);

            // Fechar painel de configurações
            document.getElementById('config-panel').style.display = 'none';

            // Recalcular
            calculate();
        }

        // Mostrar/ocultar seções de câmera conforme o modelo de cobrança
        function toggleCameraSections(billingModel) {
            document.getElementById('qrcode-section').style.display = 'none';
            document.getElementById('text-section').style.display = 'none';
            if (billingModel === 'qrcode') {
                document.getElementById('qrcode-section').style.display = 'block';
            } else if (billingModel === 'text') {
                document.getElementById('text-section').style.display = 'block';
            }
        }

        // Mostrar/ocultar campos de valor quando as promoções são selecionadas
        document.querySelectorAll('input[type="checkbox"][id^="promo-"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const valueInput = document.getElementById(`${this.id}-value`);
                if (valueInput) {
                    valueInput.style.display = this.checked ? 'block' : 'none';
                }
            });
        });

        // Alternar painel de configurações
        document.getElementById('config-btn').addEventListener('click', function() {
            const panel = document.getElementById('config-panel');
            panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
        });

        // Salvar configurações
        document.getElementById('save-config').addEventListener('click', saveConfig);

        // Alterar modelo de cobrança
        document.getElementById('billing-model').addEventListener('change', function() {
            toggleCameraSections(this.value);
        });

        // Novo cálculo
        document.getElementById('new-calculation-btn').addEventListener('click', function() {
            document.getElementById('start-time').value = '';
            document.getElementById('results').style.display = 'none';
            document.getElementById('payment-options').style.display = 'none';
        });

        // Botão de pagamento
        document.getElementById('payment-btn').addEventListener('click', function() {
            const paymentOptions = document.getElementById('payment-options');
            paymentOptions.style.display = paymentOptions.style.display === 'block' ? 'none' : 'block';
        });

        // Opções de pagamento
        document.querySelectorAll('.payment-option').forEach(option => {
            option.addEventListener('click', function() {
                const paymentType = this.getAttribute('data-type');
                alert(`Opção de pagamento selecionada: ${paymentType.toUpperCase()}\n\nFuncionalidade de pagamento será implementada em breve.`);
                document.getElementById('payment-options').style.display = 'none';
            });
        });

        // Botão salvar/compartilhar
        document.getElementById('save-share-btn').addEventListener('click', function() {
            // Em um ambiente real, isso salvaria os dados ou abriria opções de compartilhamento
            alert('Funcionalidade de salvar/compartilhar será implementada em breve.');
        });

        // Calcular automaticamente quando a hora de início for alterada
        document.getElementById('start-time').addEventListener('change', calculate);

        // Simular leitura de QR Code (em um ambiente real, isso usaria uma API de câmera)
        document.getElementById('start-qrcode').addEventListener('click', function() {
            // Em um ambiente real, isso ativaria a câmera e processaria QR codes
            // Para demonstração, vamos simular a leitura de um QR code com a hora atual
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');

            // Simular um pequeno atraso para processamento
            document.getElementById('qrcode-preview').textContent = 'Processando QR Code...';
            setTimeout(() => {
                document.getElementById('start-time').value = `${hours}:${minutes}`;
                document.getElementById('qrcode-preview').textContent = `QR Code lido: ${hours}:${minutes}`;
                calculate();
            }, 1500);
        });

        // Simular leitura de texto (em um ambiente real, isso usaria OCR)
        document.getElementById('start-text').addEventListener('click', function() {
            // Em um ambiente real, isso ativaria a câmera e usaria OCR para extrair texto
            // Para demonstração, vamos simular a leitura de um texto com a hora atual
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');

            // Simular um pequeno atraso para processamento
            document.getElementById('text-preview').textContent = 'Processando texto...';
            setTimeout(() => {
                document.getElementById('start-time').value = `${hours}:${minutes}`;
                document.getElementById('text-preview').textContent = `Texto lido: ${hours}:${minutes}`;
                calculate();
            }, 1500);
        });

        // Função para calcular o valor a pagar - CÁLCULO CORRETO DA DIÁRIA
        function calculate() {
            // Obter valores dos campos
            const startTime = document.getElementById('start-time').value;

            // Validar entradas
            if (!startTime) {
                return;
            }

            // Calcular tempo de permanência
            const now = new Date();
            const startTimeParts = startTime.split(':');
            const startDate = new Date();
            startDate.setHours(parseInt(startTimeParts[0]), parseInt(startTimeParts[1]), 0, 0);

            // Se o horário de início for no futuro (após meia-noite), ajustar
            if (startDate > now) {
                startDate.setDate(startDate.getDate() - 1);
            }

            const timeDiff = now - startDate; // em milissegundos
            const totalMinutes = Math.floor(timeDiff / (1000 * 60));

            // Calcular horas e minutos para exibição
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;

            // Aplicar tipo de cobrança
            let grossAmount = 0;
            let promoDiscount = 0;
            let promoPeriod = 'Nenhum';
            let dailyCount = 0;

            // Cobrança única
            if (config.billingType === 'unica') {
                grossAmount = config.uniqueValue;
                promoPeriod = 'Cobrança Única';
            }
            // Diária - CÁLCULO CORRETO DOS INTERVALOS
            else if (config.billingType === 'diaria') {
                // CÁLCULO CORRETO DOS INTERVALOS DE DIÁRIAS
                if (totalMinutes <= 720) { // 0-12 horas
                    dailyCount = 1;
                } else if (totalMinutes <= 1440) { // 12-24 horas
                    dailyCount = 2;
                } else if (totalMinutes <= 2160) { // 24-36 horas
                    dailyCount = 3;
                } else if (totalMinutes <= 2880) { // 36-48 horas
                    dailyCount = 4;
                } else {
                    // Para mais de 48 horas, calcular diárias adicionais
                    dailyCount = Math.ceil(totalMinutes / 720);
                }
                
                // FÓRMULA EXATA: Valor a Pagar = Diárias aplicadas * valor da diária
                grossAmount = dailyCount * config.dailyRate;
                promoPeriod = 'Diária';
                
                console.log('=== CÁLCULO DA DIÁRIA ===');
                console.log('Total minutos:', totalMinutes);
                console.log('Diárias calculadas:', dailyCount);
                console.log('Valor da diária:', config.dailyRate);
                console.log('Valor total:', grossAmount);
                console.log('=========================');
            }
            // Cobrança normal
            else {
                // Calcular frações de 15 minutos
                const fractions = Math.ceil(totalMinutes / 15);
                const fractionValue = config.hourlyRate / 4; // Valor de cada fração de 15min

                // Aplicar promoções de valor único primeiro
                let promoValueApplied = false;

                for (const promo in config.promos) {
                    if (config.promos[promo].active) {
                        const promoHours = parseInt(promo);
                        const promoMinutes = promoHours * 60;
                        const promoFractions = Math.ceil(promoMinutes / 15);

                        // Se o tempo de permanência estiver dentro do período promocional
                        if (totalMinutes <= promoMinutes) {
                            grossAmount = config.promos[promo].value;
                            promoDiscount = (fractions * fractionValue) - grossAmount;
                            promoPeriod = `Valor único até ${promoHours}h`;
                            promoValueApplied = true;
                            break;
                        }
                        // Se exceder o período promocional
                        else if (totalMinutes > promoMinutes) {
                            const excessMinutes = totalMinutes - promoMinutes;
                            const excessFractions = Math.ceil(excessMinutes / 15);
                            grossAmount = config.promos[promo].value + (excessFractions * fractionValue);
                            promoDiscount = (fractions * fractionValue) - grossAmount;
                            promoPeriod = `Valor único até ${promoHours}h + excedente`;
                            promoValueApplied = true;
                            break;
                        }
                    }
                }

                // Se nenhuma promoção de valor único foi aplicada, aplicar promoções de horas grátis
                if (!promoValueApplied) {
                    // Determinar período promocional (horas grátis)
                    let freeFractions = 0;
                    let chargedFractions = fractions;

                    switch(config.promoType) {
                        case 'free-hour-1':
                            // 1ª hora grátis (4 frações de 15min)
                            freeFractions = Math.min(4, fractions);
                            chargedFractions = Math.max(0, fractions - freeFractions);
                            promoPeriod = '1ª Hora (0h às 1h)';
                            break;
                        case 'free-hour-2':
                            // 2ª hora grátis (frações 4-7)
                            if (fractions > 4) {
                                freeFractions = Math.min(4, fractions - 4);
                                chargedFractions = 4 + Math.max(0, fractions - 8);
                            } else {
                                chargedFractions = fractions;
                            }
                            promoPeriod = '2ª Hora (1h às 2h)';
                            break;
                        case 'free-hour-3':
                            // 3ª hora grátis (frações 8-11)
                            if (fractions > 8) {
                                freeFractions = Math.min(4, fractions - 8);
                                chargedFractions = 8 + Math.max(0, fractions - 12);
                            } else {
                                chargedFractions = fractions;
                            }
                            promoPeriod = '3ª Hora (2h às 3h)';
                            break;
                        case 'free-15min':
                            // 15 minutos grátis (1 fração)
                            freeFractions = Math.min(1, fractions);
                            chargedFractions = Math.max(0, fractions - freeFractions);
                            promoPeriod = '15 Minutos (0h às 0h15)';
                            break;
                        default:
                            // Nenhuma promoção
                            promoPeriod = 'Nenhum';
                            break;
                    }

                    // Calcular desconto promocional
                    promoDiscount = freeFractions * fractionValue;

                    // Calcular valor bruto
                    grossAmount = chargedFractions * fractionValue;
                }
            }

            // Aplicar desconto adicional
            const discountAmount = grossAmount * (config.discount / 100);
            let netAmount = grossAmount - discountAmount;

            // Aplicar valor máximo
            if (config.maxValue > 0 && netAmount > config.maxValue) {
                netAmount = config.maxValue;
            }

            // Exibir resultados
            document.getElementById('calculation-date').textContent = startDate.toLocaleDateString('pt-BR');
            document.getElementById('entry-time').textContent = startTime;
            document.getElementById('duration').textContent = `${hours}h ${minutes}min`;
            document.getElementById('promo-period').textContent = promoPeriod;
            document.getElementById('promo-discount').textContent = `R$ ${promoDiscount.toFixed(2).replace('.', ',')}`;
            document.getElementById('discount-amount').textContent = `R$ ${discountAmount.toFixed(2).replace('.', ',')}`;
            document.getElementById('daily-count').textContent = dailyCount;
            
            // VALOR A PAGAR - FÓRMULA CORRETA
            document.getElementById('total-amount').textContent = `R$ ${netAmount.toFixed(2).replace('.', ',')}`;

            // Mostrar resultados
            document.getElementById('results').style.display = 'block';
        }
    </script>
</body>
</html>